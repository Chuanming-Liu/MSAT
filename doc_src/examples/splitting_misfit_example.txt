Example 6: Splitting misfit measurement and model fitting
=========================================================

In this example we show the results of various methods that can be used 
to determine the misfit between different shear wave splitting (SWS) 
parameters and illustrate how these can be used to fit a model
to measured SWS data. The four methods that are implemented in MSAT 
which can be used to estimate the difference between one 
splitting parameter, latexmath:[$\Gamma_1 = (dt_1 , \phi_1)$], and 
a second, latexmath:[$\Gamma_2 = (dt_2 , \phi_2)$], are first outlined
and results illustrated. In the second part of the example we show 
how this approach can be used to find the best-fitting model assuming 
tilted transverse isotropy (TTI) to a collection of synthetic SWS 
measurements. 

Calculating a misfit
--------------------

The example file `demo_splitting_misfit.m` in the `examples/splitting_misfit`
directory shows how the MSAT function `MS_splitting_misfit` can be used 
and plots the value of the misfit function for pairs of splitting 
parameters. The reference splitting parameters, latexmath:[$\Gamma_1$],
for this illustration are latexmath:[$dt_1 = 2$] seconds and 
latexmath:[$\phi_1 = 0$] degrees. This is compared with 
latexmath:[$\Gamma_2$] with values varying from
latexmath:[$\phi_2 = -90$] to latexmath:[$\phi_2 = 90$] degrees and 
latexmath:[$dt_2 = 0$] to latexmath:[$dt_2 = 4$] seconds. For the methods
that are sensitive to source polarization three values are used, 45, 
30 and 0 degrees. The calculation of misfit over this grid of values 
of latexmath:[$\Gamma_2$] is done as follows in the function 
`calc_misfit_surface`:
[code, python]
----
   fast = [-90:5:90] ;
   tlag = [0:0.1:4] ;

   [TLAG,FAST] = meshgrid(tlag,fast) ;
   MISFIT = FAST.*0 ;

   % generate misfit 
   for itlag=1:length(tlag)
      for ifast=1:length(fast)
        MISFIT(ifast,itlag) = ...
           MS_splitting_misfit(fast_ref,tlag_ref, ...
              fast(ifast),tlag(itlag),spol,0.1,'mode',modeStr,'max_tlag',10) ;
      end
   end

----
The call to `MS_splitting_misfit` calculates the misfit for each of the 
values of latexmath:[$\Gamma_2$]. This is done for each of the 
polarisation directions and misfit calculation methods ("simple", 
"intensity", "lam2" and "lam2S") and the calculated misfit 
surfaces plotted.

image:splitting_misfit_pol0.png[Misfit surfaces for 0 degree polarisation]

The images above show the misfit surfaces produced by the 
`demo_splitting_misfit` example for the 0 degree polarisation angle. 
It is instructive to first consider the "simple" approach (lower left 
figure). This approach takes the average of the magnitude of the  
difference between the delay times and magnitude of the difference
of between the fast directions. That is:

latexmath:[$\displaystyle{\frac{1}{2} \left(\frac{|dt_1-dt_2|}{(0.25/f_d)} + \frac{|\phi_1 - \phi_1|}{90}\right)}$],
 
where latexmath:[$f_d$], the dominant frequency, and 90 are included to 
properly normalise the two parts of the sum. This is not dependent on the
initial polarisation direction and always forms a diamond shape with a minimum
located at the point where latexmath:[$dt_1 = dt_2$] and latexmath:[$\phi_1 = \phi_2$].
Another approach is the comparison of splitting intensity 
activated by the "intensity" method. The approach is to calculate the
splitting intensity for both pairs of parameters:

latexmath:[$\displaystyle{S_i = dt_i \sin(2 \beta_i)}$],

(where latexmath:[$\beta$] is the difference between the polarisation angle 
and latexmath:[$\phi$]) and taking the magnitude of the difference between 
latexmath:[$S_1$] and latexmath:[$S_2$].

  
WORKS LIKE THIS. SHOWN IN XXX. MSAT also implements two other
approaches motivated by the way that SWS parameters are 
extracted and, in particular the XXX method of (REFERENCES). 
Details of the approach, which involves splitting a 
probe wavelet using latexmath:[$\Gamma_1$],  
"unsplitting" it using latexmath:[$\Gamma_2$], and comparing the 
result with the probe wavelet, is given in the user guide 
LINK but the results are shown in the XXX and YYY figures. In the 
following section the "XXX" misfit function is used to


Misfit to model
---------------

The file does

CHOP UP AND EXPLAIN.


    

